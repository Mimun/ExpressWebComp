<!DOCTYPE html>
<html lang="">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap Testbed</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Material Design Bootstrap</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <!-- <link href="css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="../../node_modules/mdbootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <!-- <link href="css/mdb.min.css" rel="stylesheet"> -->
    <link href="../../node_modules/mdbootstrap/css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <!-- <link href="css/style.css" rel="stylesheet"> -->
    <style>
        body {
            padding: 20px;
        }

        .list-group-item {
            cursor: move;
        }

        .chosen {
            color: #baf;
            background-color: #007bff;
        }

        /* ghostClass */
        .ghost {
            opacity: .8;
            background: #c00;
        }
    </style>


</head>

<body>
    <h1 class="text-center">Simple Sortable without WC</h1>


    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <fieldset class="scheduler-border">
                <legend class="scheduler-border ">Create Option Set by Drag & Drop </legend>
                <sortable-wc id="Right">
                    <chipl class="list-group-item" role="alert">bar 1</chipl>
                    <chipl class="list-group-item" role="alert">bar 2</chipl>
                    <chipl class="list-group-item" role="alert">bar 3</chipl>
                    <!-- <basiccomp-wc>ABCD</basiccomp-wc>
                        <basiccomp-wc/></basiccomp-wc>
                        <basiccomp-wc></basiccomp-wc>
                        <basiccomp-wc></basiccomp-wc> -->
                </sortable-wc>
            </fieldset>
        </div>
        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
            <fieldset class="scheduler-border">
                <legend class="scheduler-border">Input Types</legend>
                <sortable-wc id="Left">
                    <chipl class="list-group-item" role="alert" id='tao'>foo 1</chipl>
                    <chipl class="list-group-item" role="alert">foo 2</chipl>
                    <chipl class="list-group-item" role="alert">foo 3</chipl>
                    <basiccomp-wc class="list-group-item" data-id="meo" />
                    </basiccomp-wc>
                    <basiccomp-wc class="list-group-item" />
                    </basiccomp-wc>
                    <basiccomp-wc class="list-group-item" />
                    </basiccomp-wc>
                    <basiccomp-wc class="list-group-item" />
                    </basiccomp-wc>
                </sortable-wc>
            </fieldset>
        </div>



    </div>


    <script type="module" src="../BasicComponentWC/BasicComponentWC/BasicComponentWC.js"></script>

    <script type="text/javascript" src="../../node_modules/mdbootstrap/js/jquery-3.4.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="../../node_modules/mdbootstrap/js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="../../node_modules/mdbootstrap/js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="../../node_modules/mdbootstrap/js/mdb.min.js"></script>

    <script src="../../node_modules/sortablejs/Sortable.js"></script>

    <script>
        var preventDropOutside = Sortable.create(Right, {
            group: {
                name: 'shared',
                pull: 'clone' // To clone: set pull to 'clone'
            },
            animation: 150,
            onAdd: function ( /**Event*/ evt) {
                cloningElement(evt);
            },

            onChange: function ( /**Event*/ evt) {

            },
            onEnd: function ( /**Event*/ evt) {
                cloningElement(evt);
            }
        });

        function cloningElement(evt) {
            var old_element = evt.item
            var new_element = old_element.cloneNode(true);

            if (!old_element.parentNode) {
                return;
            }
            old_element.parentNode.replaceChild(new_element, old_element);
            new_element.addEventListener('wc_click', (el) => {

                $(".popover").each(function () {
                    console.log('audit:', this);
                    $(this).popover("hide");
                });
                $(new_element).popover('show');

            }, false);
            new_element.cust_content =
                `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur venenatis tristique est. Nam euismod iaculis felis, eget facilisis nulla congue vitae. Nunc pretium arcu in sapien fermentum porta. Etiam at accumsan felis, id luctus justo. Phasellus vehicula lectus ligula, et viverra arcu pulvinar et. Interdum et malesuada fames ac ante ipsum primis in faucibus. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Maecenas eu sapien mi.

Integer convallis vulputate sem, id tristique nisi blandit quis. Nullam finibus sit amet lacus sed tristique. Vivamus non ex suscipit, tincidunt nunc scelerisque, ornare nunc. Ut tellus ipsum, bibendum nec euismod ac, pulvinar in lacus. Vestibulum at scelerisque risus. Donec et facilisis orci. Vestibulum iaculis euismod magna, eget iaculis risus. Vivamus erat dolor, lacinia id elit in, eleifend blandit elit. Nam nisi velit, tincidunt in ligula ac, aliquam aliquet nunc.`

            

            $(new_element).popover({
                animation: true,
                title: "chipl",
                // trigger: "click",
                content: getHTML_Template(new_element),
                placement: "right",
                delay: {
                    "show": 500,
                    "hide": 1100
                },
                // template: _content,
                html: true,
            });
            console.log("popover:", getHTML_Template(new_element));
        }

        new Sortable(Left, {
            group: {
                name: 'shared',
                pull: 'clone',
                put: false
            },
            animation: 150
        });


        function addSortableOutsideDrop(sortableInstance, callback) {
            var enableDragover = function (evt) {
                evt.preventDefault();
            };
            document.documentElement.addEventListener("dragover", enableDragover);

            var setToInsideDrop = function () {
                sortableInstance._isOutsideDrop = false;
            };
            // Set to inside drop if dropping inside the sortable element
            sortableInstance.el.addEventListener("drop", setToInsideDrop);
            // Set to inside drop if moving items across sortable lists
            Sortable.utils.on(sortableInstance.el, "add", setToInsideDrop);
            Sortable.utils.on(sortableInstance.el, "remove", setToInsideDrop);

            // On start, initialize to be outside drop
            Sortable.utils.on(sortableInstance.el, "start", function (evt) {
                sortableInstance._isOutsideDrop = true;
            });
            // Check if is still outside drop, and if it is, do callback
            Sortable.utils.on(sortableInstance.el, "end", function (evt) {
                if (sortableInstance._isOutsideDrop || typeof (sortableInstance._isOutsideDrop) == 'undefined')
                    callback(evt);
            });

        }

        function getHTML_Template(e) {
            // 
             return document.createElement('div').innerHTML = `<div><div class = "popover-content"> ${e.cust_content} Con vit buoc loai 1 </div><button type="button" id="example" class="btn btn-primary" ></button></div>`;
            // return  `<div><div class = "popover-content"> ${e.cust_content} Con vit buoc loai 1 </div><button type="button" id="example" class="btn btn-primary" ></button></div>`.tohtml;
        }

        addSortableOutsideDrop(preventDropOutside, function (evt) {
            var el = evt.item;
            el.parentNode.removeChild(el);
            // alert('Trashed: ' + el.textContent);
        });
    </script>

</body>

</html>